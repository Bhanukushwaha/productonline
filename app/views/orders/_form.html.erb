<div class="container">
<%= form_with(model: order) do |form| %>
  <% if order.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>  

  <div class="field">
    <%= form.label :first_name %>
    <%= form.text_field :first_name %>
  </div>

  <div class="field">
    <%= form.label :last_name %>
    <%= form.text_field :last_name %>
  </div>

  <div class="field">
    <%= form.label :email %>
    <%= form.number_field :email %>
  </div>

  <div class="field">
    <%= form.label :phone %>
    <%= form.number_field :phone %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>


</div>
<div class="field">
  <strong for="choose_address">Choose Address</strong>
  <% current_user.addresses.each do |ad|%>
  <p><input type="radio" name="order[address_id]" class="choose_address" value="<%= ad.id %>"> <%= ad.full_address %></p>
  <% end %>
  <a href="/addresses/new?cart=new_address" class="btn btn-success", style= "color:white;">Add new address</a>
</div>
<% if current_user.addresses.any? %> 
        <article>
          <% if flash[:error].present? %>
          <div id="error_explanation">
            <p><%= flash[:error] %></p>
          </div>
          <% end %>
          <label class="amount">
          <span>Amount: $<%= current_cart.sub_total %></span>
          </label>
        </article>
         
           <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
           <script src="https://checkout.stripe.com/v2/checkout.js"></script>
           <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
      <% else %>
        <a href="/addresses/new?cart=new_address" class="btn btn-success", style= "color:white;">Please add new address </a>
        
      <% end %>
    <% end %>


<script>
  $(document).ready(function() {
      $(':submit').on('click', function(event) {
          event.preventDefault();
          var $button = $(this),
              $form = $button.parents('form');
          var opts = $.extend({}, $button.data(), {
              token: function(result) {
                  $form.append($('<input>').attr({ type: 'hidden', name: 'stripeToken', value: result.id })).submit();
              }
          });
          StripeCheckout.open(opts);
      });
  });
</script>

<script type="text/javascript">
  $(function(){
    $("input[type='radio']").change(function(){
      $("input[type='submit']").prop("disabled", false);
    });
  });
  $(document).ready(function(){
    $("input").prop('required', true);
    $("text_field").prop('required', true);
  });
</script>
